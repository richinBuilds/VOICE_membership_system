<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Select your membership plan - VOICE Membership">

    <title>Select Membership - VOICE Membership System</title>

    <!-- Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Global CSS -->
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>

<body style="background: var(--bg-bone);">

<div class="checkout-container" data-testid="register-step3-container">

    <div class="checkout-card">

        <!-- Header -->
        <div class="checkout-header">

            <h1 class="checkout-title" data-testid="step3-title">
                <i class="fas fa-crown me-2"></i>
                Select Membership
            </h1>

            <p class="text-muted">
                Step <span th:text="${step}">3</span>
                of <span th:text="${totalSteps}">4</span>
                â€” Choose Your Plan
            </p>

            <!-- Step Indicator -->
            <div class="step-indicator" data-testid="step-indicator">
                <div class="step active">1</div>
                <div class="step active">2</div>
                <div class="step active">3</div>
                <div class="step">4</div>
            </div>

        </div>

        <!-- Form -->
        <form th:action="@{/register/step3}"
              method="post"
              id="membershipForm"
              data-testid="membership-form">

            <input type="hidden"
                   th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}"/>

            <!-- Membership Cards Grid -->
            <div class="membership-grid">

                <div th:each="membership, stat : ${memberships}"
                     class="membership-card"
                     th:id="'card-' + ${membership.id}"
                     th:onclick="'selectMembership(' + ${membership.id} + ')'"
                     th:data-testid="'membership-option-' + ${stat.index}">

                    <input type="radio"
                           hidden
                           th:id="'membership-' + ${membership.id}"
                           name="membershipId"
                           th:value="${membership.id}"
                           th:checked="${selectedMembershipId != null && selectedMembershipId == membership.id}">

                    <!-- Card Header -->
                    <div class="membership-header">
                        <h3 th:text="${membership.name}">
                            Membership Name
                        </h3>

                        <div class="membership-price" th:if="${membership.isFree}">
                            Free
                        </div>

                        <div class="membership-price" th:unless="${membership.isFree}">
                            $<span th:text="${membership.price}">0</span>
                        </div>
                    </div>

                    <!-- Card Body -->
                    <div class="membership-body">
                        <p class="membership-description" th:text="${membership.description}">
                            Membership description here.
                        </p>

                        <ul class="membership-features"
                            th:if="${membership.features != null}">
                            <li th:each="feature : ${#strings.arraySplit(membership.features, lineSeparator)}"
                                th:text="${feature.trim()}">
                                Feature item
                            </li>
                        </ul>
                    </div>

                </div>

            </div>

            <!-- Navigation Buttons -->
            <div class="btn-group-custom">

                <a th:href="@{/register/step2}"
                   class="btn btn-secondary-custom"
                   data-testid="step3-back-btn">
                    <i class="fas fa-arrow-left me-1"></i> Back
                </a>

                <button type="submit"
                        id="nextButton"
                        class="btn btn-primary-custom"
                        disabled
                        data-testid="step3-next-btn">
                    Continue
                    <i class="fas fa-arrow-right ms-1"></i>
                </button>

            </div>

        </form>

    </div>

</div>

<!-- Bootstrap JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<script>
// Select membership card
function selectMembership(id) {
    // Remove selection from all cards
    document.querySelectorAll('.membership-card').forEach(function(card) {
        card.classList.remove('selected');
    });

    // Check the radio button
    const radio = document.getElementById('membership-' + id);
    if (radio) {
        radio.checked = true;
    }

    // Highlight selected card
    const card = document.getElementById('card-' + id);
    if (card) {
        card.classList.add('selected');
    }

    // Enable the next button
    document.getElementById('nextButton').disabled = false;
}

// Restore previous selection on page load
document.addEventListener('DOMContentLoaded', function() {
    const checkedRadio = document.querySelector('input[type="radio"]:checked');
    if (checkedRadio) {
        selectMembership(checkedRadio.value);
    }
});

// Keyboard navigation for accessibility
document.querySelectorAll('.membership-card').forEach(function(card) {
    card.setAttribute('tabindex', '0');
    card.setAttribute('role', 'button');
    
    card.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            card.click();
        }
    });
});
</script>

</body>
</html>
